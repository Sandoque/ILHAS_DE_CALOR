{% extends 'base.html' %}
{% block content %}
<section class="mb-8">
  <h1 class="text-2xl font-bold mb-2">Simulador Climático</h1>
  <p class="text-slate-600">Ajuste variáveis climáticas para projetar cenários e avaliar riscos de ilhas de calor.</p>
</section>

<section class="grid gap-6 lg:grid-cols-3">
  <div class="card lg:col-span-1">
    <form id="simulator-form" hx-post="/api/simulation/future" hx-target="#simulation-result" hx-swap="none">
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1">Estação</label>
        <select name="station_code" id="station-select" class="w-full border rounded-lg px-3 py-2" required></select>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1">Aumento percentual de temperatura (%)</label>
        <input type="number" step="0.1" name="climate_variables[temperature]" class="w-full border rounded-lg px-3 py-2" placeholder="Ex: 2.5" />
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1">Alteração de precipitação (mm)</label>
        <input type="number" step="0.1" name="climate_variables[precipitation]" class="w-full border rounded-lg px-3 py-2" placeholder="Ex: -5" />
      </div>
      <div class="mb-6">
        <label class="block text-sm font-semibold mb-1">Ajuste de umidade (%)</label>
        <input type="number" step="0.1" name="climate_variables[humidity]" class="w-full border rounded-lg px-3 py-2" placeholder="Ex: 3" />
      </div>
      <button type="submit" class="btn-primary w-full">Simular</button>
    </form>
  </div>

  <div class="card lg:col-span-2">
    <div class="flex items-center justify-between mb-3">
      <h2 class="section-title">Projeção</h2>
    </div>
    <div id="simulation-chart" class="h-72">{% include 'components/chart_loader.html' %}</div>
    <div id="simulation-result" class="mt-4 grid gap-3 md:grid-cols-3"></div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const resp = await fetch('/api/stations');
      const json = await resp.json();
      const select = document.getElementById('station-select');
      (json.data || []).forEach(station => {
        const option = document.createElement('option');
        option.value = station.station_code;
        option.textContent = `${station.station_code} – ${station.name || station.municipality || ''}`;
        select.appendChild(option);
      });
    } catch (err) {
      console.error('Erro ao carregar estações', err);
    }
  });
</script>
{% endblock %}
