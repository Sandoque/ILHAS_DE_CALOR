<!-- Partial template para gráficos HTMX -->
<div id="charts-container" class="space-y-6" data-cidade-id="{{ cidade_id }}" data-range="{{ range }}">
    
    <!-- Gráfico de Temperatura -->
    <div class="card">
        <div class="card-header">
            <h3 class="text-lg font-semibold text-gray-900">Série Temporal de Temperatura</h3>
            <p class="text-sm text-gray-600">Mínima, média e máxima diária</p>
        </div>
        <div class="card-body">
            <div id="chart-temperatura" class="chart-container"></div>
        </div>
    </div>

    <!-- Gráfico de Risco -->
    <div class="card">
        <div class="card-header">
            <h3 class="text-lg font-semibold text-gray-900">Distribuição de Risco de Calor</h3>
            <p class="text-sm text-gray-600">Contagem de dias por nível de risco</p>
        </div>
        <div class="card-body">
            <div id="chart-risco" class="chart-container"></div>
        </div>
    </div>

    <!-- Heatmap -->
    <div class="card">
        <div class="card-header">
            <h3 class="text-lg font-semibold text-gray-900">Heatmap Térmico (últimos 7 dias)</h3>
            <p class="text-sm text-gray-600">Intensidade de temperatura por dia</p>
        </div>
        <div class="card-body">
            <div id="chart-heatmap" class="chart-container"></div>
        </div>
    </div>

</div>

<script>
(function() {
    /**
     * IIFE para carregamento de gráficos via DashboardCharts
     * Extrai cidadeId e range dos atributos data-* do container
     */
    function renderCharts() {
        const container = document.getElementById('charts-container');
        if (!container) return;

        const cidadeId = container.getAttribute('data-cidade-id');
        const range = parseInt(container.getAttribute('data-range') || 7, 10);

        if (!cidadeId) {
            console.error('cidadeId não encontrado no container');
            return;
        }

        // Carrega 3 gráficos em paralelo usando o módulo DashboardCharts
        DashboardCharts.loadMultipleCharts([
            { domId: 'chart-temperatura', type: 'temperatura', cidadeId, range },
            { domId: 'chart-risco', type: 'risco', cidadeId, range },
            { domId: 'chart-heatmap', type: 'heatmap', cidadeId }
        ]).then(() => {
            console.log('Gráficos renderizados com sucesso');
        }).catch(error => {
            console.error('Erro ao renderizar gráficos:', error);
        });
    }

    // Executar quando HTMX carrega este partial
    document.addEventListener('htmx:afterSwap', renderCharts);
    
    // Executar na primeira carga se não for HTMX
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', renderCharts);
    } else {
        renderCharts();
    }
})();
</script>
