{% extends 'base.html' %}
{% block content %}
<section class="mb-10">
  <div class="bg-gradient-to-r from-emerald-500 to-amber-500 text-white rounded-3xl p-8 shadow-xl flex flex-col gap-4 animate-fade-in">
    <p class="text-sm uppercase tracking-[0.2em]">Dashboard Estadual</p>
    <h1 class="text-3xl sm:text-4xl font-bold">Observatório Estadual de Ilhas de Calor – PE</h1>
    <p class="text-lg text-emerald-50 max-w-2xl">Monitoramento climático e análise de risco para gestores públicos</p>
    <div class="flex flex-wrap gap-3">
      <a href="/simulator" class="btn-primary">Abrir simulador</a>
      <a href="#heatmap" class="btn-primary bg-white text-emerald-600 hover:text-emerald-700">Ver mapa</a>
    </div>
  </div>
</section>

<section class="grid gap-4 md:grid-cols-3 mb-10">
  <div hx-get="/api/analytics/hottest?limit=1" hx-trigger="load" hx-swap="none" data-metric="max-temp" class="card">
    <div id="metric-hot">{% include 'components/card_metric.html' with context %}</div>
  </div>
  <div hx-get="/api/analytics/hottest?limit=1" hx-trigger="load" hx-swap="none" data-metric="hottest-station" class="card">
    <div id="metric-station">{% include 'components/card_metric.html' with context %}</div>
  </div>
  <div hx-get="/api/analytics/alerts?threshold=0" hx-trigger="load" hx-swap="none" data-metric="amplitude" class="card">
    <div id="metric-amplitude">{% include 'components/card_metric.html' with context %}</div>
  </div>
</section>

<section id="heatmap" class="mb-10">
  <div class="flex items-center justify-between mb-4">
    <h2 class="section-title">Mapa de calor estadual</h2>
    <input type="date" id="heatmap-date" class="border rounded-lg px-3 py-2 text-sm" />
  </div>
  <div class="card chart-container" id="heatmap-chart">
    {% include 'components/chart_loader.html' %}
  </div>
</section>

<section class="mb-10">
  <div class="flex items-center justify-between mb-4">
    <h2 class="section-title">Ranking de estações mais quentes</h2>
  </div>
  <div class="card overflow-hidden">
    <div hx-get="/api/analytics/hottest" hx-trigger="load" hx-swap="none" id="ranking-loader" class="animate-pulse text-sm text-slate-500 p-4">Carregando ranking...</div>
    <div id="ranking-chart" class="h-80"></div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dateInput = document.getElementById('heatmap-date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.value = today;
    const container = document.getElementById('heatmap-chart');
    renderHeatmap(container, `/api/analytics/heatmap/${today}`);

    dateInput.addEventListener('change', () => {
      const date = dateInput.value;
      renderHeatmap(container, `/api/analytics/heatmap/${date}`);
    });
  });
</script>
{% endblock %}
